<!DOCTYPE html><html lang="es"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Costos de Recetas</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Calcula costos, márgenes y precios de venta de recetas de manera profesional">
    <meta name="theme-color" content="#5D5CDE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Costos Recetas">
    <meta name="msapplication-TileColor" content="#5D5CDE">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/mipwa/manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .ingredient-row {
            transition: all 0.3s ease;
        }
        .ingredient-row:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }
        .dark .ingredient-row:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-primary mb-2">Calculadora de Costos de Recetas</h1>
            <p class="text-gray-600 dark:text-gray-400">Calcula costos, márgenes y precios de venta de manera profesional</p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Ingredientes Section -->
            <div class="lg:col-span-2">
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold">Ingredientes</h2>
                        <button id="addIngredientBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                            + Agregar Ingrediente
                        </button>
                    </div>

                    <!-- Ingredientes Header -->
                    <div class="grid grid-cols-12 gap-2 mb-4 text-sm font-medium text-gray-600 dark:text-gray-400 border-b pb-2">
                        <div class="col-span-4">Ingrediente</div>
                        <div class="col-span-2">Cantidad</div>
                        <div class="col-span-2">Masa (ml/g)</div>
                        <div class="col-span-2">Costo Unit.</div>
                        <div class="col-span-1">Costo Total</div>
                        <div class="col-span-1"></div>
                    </div>

                    <!-- Ingredientes List -->
                    <div id="ingredientsList" class="space-y-2">
                        <!-- Ingredientes iniciales -->
                        <div class="ingredient-row grid grid-cols-12 gap-2 items-center py-2 rounded-lg">
                            <input type="text" class="col-span-4 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Nombre del ingrediente" value="Producto lácteo">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Cant." value="5" min="0" step="0.1">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="ml/g" value="1000" min="0" step="0.1">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="$0.00" value="12" min="0" step="0.01">
                            <span class="col-span-1 text-sm font-medium text-gray-700 dark:text-gray-300 cost-display">$60.00</span>
                            <button class="col-span-1 text-red-500 hover:text-red-700 remove-ingredient p-1">✕</button>
                        </div>
                        <div class="ingredient-row grid grid-cols-12 gap-2 items-center py-2 rounded-lg">
                            <input type="text" class="col-span-4 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Nombre del ingrediente" value="Leche en polvo">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Cant." value="1" min="0" step="0.1">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="ml/g" value="120" min="0" step="0.1">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="$0.00" value="20" min="0" step="0.01">
                            <span class="col-span-1 text-sm font-medium text-gray-700 dark:text-gray-300 cost-display">$20.00</span>
                            <button class="col-span-1 text-red-500 hover:text-red-700 remove-ingredient p-1">✕</button>
                        </div>
                        <div class="ingredient-row grid grid-cols-12 gap-2 items-center py-2 rounded-lg">
                            <input type="text" class="col-span-4 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Nombre del ingrediente" value="Crema para batir">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Cant." value="1" min="0" step="0.1">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="ml/g" value="500" min="0" step="0.1">
                            <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="$0.00" value="50" min="0" step="0.01">
                            <span class="col-span-1 text-sm font-medium text-gray-700 dark:text-gray-300 cost-display">$50.00</span>
                            <button class="col-span-1 text-red-500 hover:text-red-700 remove-ingredient p-1">✕</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calculations Section -->
            <div class="space-y-6">
                <!-- Configuración -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Configuración</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Unidades que rinde</label>
                            <input type="number" id="unitsYield" class="w-full px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" value="40" min="1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">% Añadido</label>
                            <input type="number" id="addedPercentage" class="w-full px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" value="30" min="0" step="0.1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">% Beneficio esperado</label>
                            <input type="number" id="profitPercentage" class="w-full px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" value="150" min="0" step="0.1">
                        </div>
                    </div>
                </div>

                <!-- Resultados -->
                <div class="bg-primary/10 dark:bg-primary/20 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Análisis de Costos</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm">Total costos ingredientes:</span>
                            <span class="font-bold" id="totalIngredientsCost">$130.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Monto añadido:</span>
                            <span class="font-bold" id="addedAmount">$39.00</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="text-sm font-medium">Total costos:</span>
                            <span class="font-bold" id="totalCosts">$169.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Costo unitario:</span>
                            <span class="font-bold" id="unitCost">$4.23</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Ganancia por unidad:</span>
                            <span class="font-bold text-green-600" id="profitPerUnit">$6.34</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="text-sm font-medium">Precio de venta unitario:</span>
                            <span class="font-bold text-lg text-primary" id="sellingPrice">$10.57</span>
                        </div>
                    </div>
                </div>

                <!-- Resumen de masa -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Resumen de Masa</h3>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary" id="totalMass">1620</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">ml/g totales</div>
                    </div>
                </div>

                <!-- Export PDF Button -->
                <div class="text-center">
                    <button id="exportPdfBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-lg">
                        📄 Exportar a PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // DOM elements
        const ingredientsList = document.getElementById('ingredientsList');
        const addIngredientBtn = document.getElementById('addIngredientBtn');
        const unitsYield = document.getElementById('unitsYield');
        const addedPercentage = document.getElementById('addedPercentage');
        const profitPercentage = document.getElementById('profitPercentage');

        // Add event listeners
        addIngredientBtn.addEventListener('click', addIngredient);
        unitsYield.addEventListener('input', calculateAll);
        addedPercentage.addEventListener('input', calculateAll);
        profitPercentage.addEventListener('input', calculateAll);
        document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);

        function addIngredient() {
            const ingredientRow = document.createElement('div');
            ingredientRow.className = 'ingredient-row grid grid-cols-12 gap-2 items-center py-2 rounded-lg';
            ingredientRow.innerHTML = `
                <input type="text" class="col-span-4 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Nombre del ingrediente">
                <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="Cant." value="1" min="0" step="0.1">
                <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="ml/g" value="0" min="0" step="0.1">
                <input type="number" class="col-span-2 px-3 py-2 border rounded-lg text-base bg-white dark:bg-gray-700 dark:border-gray-600" placeholder="$0.00" value="0" min="0" step="0.01">
                <span class="col-span-1 text-sm font-medium text-gray-700 dark:text-gray-300 cost-display">$0.00</span>
                <button class="col-span-1 text-red-500 hover:text-red-700 remove-ingredient p-1">✕</button>
            `;
            ingredientsList.appendChild(ingredientRow);
            
            // Add event listeners to new inputs
            const inputs = ingredientRow.querySelectorAll('input[type="number"]');
            inputs.forEach(input => input.addEventListener('input', calculateAll));
            
            // Add remove functionality
            const removeBtn = ingredientRow.querySelector('.remove-ingredient');
            removeBtn.addEventListener('click', () => {
                ingredientRow.remove();
                calculateAll();
            });
        }

        function calculateAll() {
            const rows = document.querySelectorAll('.ingredient-row');
            let totalIngredientsCost = 0;
            let totalMass = 0;

            // Calculate individual ingredient costs and totals
            rows.forEach(row => {
                const quantity = parseFloat(row.children[1].value) || 0;
                const mass = parseFloat(row.children[2].value) || 0;
                const unitCost = parseFloat(row.children[3].value) || 0;
                const cost = quantity * unitCost;
                
                row.querySelector('.cost-display').textContent = `$${cost.toFixed(2)}`;
                totalIngredientsCost += cost;
                totalMass += mass * quantity;
            });

            // Get configuration values
            const units = parseFloat(unitsYield.value) || 1;
            const addedPercent = parseFloat(addedPercentage.value) || 0;
            const profitPercent = parseFloat(profitPercentage.value) || 0;

            // Calculate derived values
            const addedAmount = totalIngredientsCost * addedPercent / 100;
            const totalCosts = totalIngredientsCost + addedAmount;
            const unitCost = totalCosts / units;
            const profitPerUnit = unitCost * profitPercent / 100;
            const sellingPrice = unitCost + profitPerUnit;

            // Update display
            document.getElementById('totalIngredientsCost').textContent = `$${totalIngredientsCost.toFixed(2)}`;
            document.getElementById('addedAmount').textContent = `$${addedAmount.toFixed(2)}`;
            document.getElementById('totalCosts').textContent = `$${totalCosts.toFixed(2)}`;
            document.getElementById('unitCost').textContent = `$${unitCost.toFixed(2)}`;
            document.getElementById('profitPerUnit').textContent = `$${profitPerUnit.toFixed(2)}`;
            document.getElementById('sellingPrice').textContent = `$${sellingPrice.toFixed(2)}`;
            document.getElementById('totalMass').textContent = totalMass.toFixed(0);
        }

        // Initialize event listeners for existing ingredients
        document.addEventListener('DOMContentLoaded', () => {
            const existingInputs = document.querySelectorAll('.ingredient-row input[type="number"]');
            existingInputs.forEach(input => input.addEventListener('input', calculateAll));

            const removeButtons = document.querySelectorAll('.remove-ingredient');
            removeButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.target.closest('.ingredient-row').remove();
                    calculateAll();
                });
            });

            // Initial calculation
            calculateAll();
        });

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Get current date
            const currentDate = new Date().toLocaleDateString('es-ES');
            
            // Header
            pdf.setFontSize(20);
            pdf.setFont("helvetica", "bold");
            pdf.text('REPORTE DE COSTOS DE RECETA', 20, 25);
            
            pdf.setFontSize(12);
            pdf.setFont("helvetica", "normal");
            pdf.text(`Fecha: ${currentDate}`, 20, 35);
            
            // Line separator
            pdf.line(20, 45, 190, 45);
            
            // Ingredients section
            let yPosition = 55;
            pdf.setFontSize(14);
            pdf.setFont("helvetica", "bold");
            pdf.text('INGREDIENTES', 20, yPosition);
            
            yPosition += 10;
            pdf.setFontSize(10);
            pdf.setFont("helvetica", "bold");
            pdf.text('Ingrediente', 20, yPosition);
            pdf.text('Cantidad', 80, yPosition);
            pdf.text('Masa (ml/g)', 110, yPosition);
            pdf.text('Costo Unit.', 140, yPosition);
            pdf.text('Costo Total', 170, yPosition);
            
            // Draw line under headers
            pdf.line(20, yPosition + 2, 190, yPosition + 2);
            
            yPosition += 8;
            pdf.setFont("helvetica", "normal");
            
            // Get ingredients data
            const rows = document.querySelectorAll('.ingredient-row');
            rows.forEach(row => {
                const name = row.children[0].value || 'Sin nombre';
                const quantity = row.children[1].value || '0';
                const mass = row.children[2].value || '0';
                const unitCost = row.children[3].value || '0';
                const totalCost = row.querySelector('.cost-display').textContent;
                
                // Check if we need a new page
                if (yPosition > 270) {
                    pdf.addPage();
                    yPosition = 25;
                }
                
                pdf.text(name.substring(0, 25), 20, yPosition);
                pdf.text(quantity, 80, yPosition);
                pdf.text(mass, 110, yPosition);
                pdf.text(`$${unitCost}`, 140, yPosition);
                pdf.text(totalCost, 170, yPosition);
                yPosition += 8;
            });
            
            // Configuration section
            yPosition += 10;
            pdf.line(20, yPosition, 190, yPosition);
            yPosition += 10;
            
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(14);
            pdf.text('CONFIGURACIÓN', 20, yPosition);
            
            yPosition += 10;
            pdf.setFontSize(10);
            pdf.setFont("helvetica", "normal");
            
            const units = document.getElementById('unitsYield').value;
            const addedPercent = document.getElementById('addedPercentage').value;
            const profitPercent = document.getElementById('profitPercentage').value;
            
            pdf.text(`Unidades que rinde: ${units}`, 20, yPosition);
            yPosition += 6;
            pdf.text(`Porcentaje añadido: ${addedPercent}%`, 20, yPosition);
            yPosition += 6;
            pdf.text(`Beneficio esperado: ${profitPercent}%`, 20, yPosition);
            
            // Results section
            yPosition += 15;
            pdf.line(20, yPosition, 190, yPosition);
            yPosition += 10;
            
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(14);
            pdf.text('ANÁLISIS DE COSTOS', 20, yPosition);
            
            yPosition += 10;
            pdf.setFontSize(10);
            pdf.setFont("helvetica", "normal");
            
            // Get calculated values
            const totalIngredientsCost = document.getElementById('totalIngredientsCost').textContent;
            const addedAmount = document.getElementById('addedAmount').textContent;
            const totalCosts = document.getElementById('totalCosts').textContent;
            const unitCost = document.getElementById('unitCost').textContent;
            const profitPerUnit = document.getElementById('profitPerUnit').textContent;
            const sellingPrice = document.getElementById('sellingPrice').textContent;
            const totalMass = document.getElementById('totalMass').textContent;
            
            pdf.text(`Total costos ingredientes: ${totalIngredientsCost}`, 20, yPosition);
            yPosition += 6;
            pdf.text(`Monto añadido: ${addedAmount}`, 20, yPosition);
            yPosition += 6;
            pdf.text(`Total costos: ${totalCosts}`, 20, yPosition);
            yPosition += 6;
            pdf.text(`Costo unitario: ${unitCost}`, 20, yPosition);
            yPosition += 6;
            pdf.text(`Ganancia por unidad: ${profitPerUnit}`, 20, yPosition);
            yPosition += 10;
            
            // Highlight selling price
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(12);
            pdf.text(`PRECIO DE VENTA UNITARIO: ${sellingPrice}`, 20, yPosition);
            
            yPosition += 10;
            pdf.setFont("helvetica", "normal");
            pdf.setFontSize(10);
            pdf.text(`Masa total: ${totalMass} ml/g`, 20, yPosition);
            
            // Footer
            yPosition += 20;
            pdf.setFontSize(8);
            pdf.setFont("helvetica", "italic");
            pdf.text('Generado por Calculadora de Costos de Recetas', 20, yPosition);
            
            // Save the PDF
            pdf.save(`costos-receta-${currentDate}.pdf`);
        }
    </script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/mipwa/service-worker.js')
      .then(() => console.log('✔ Service Worker registrado'))
      .catch(err => console.error('❌ Error registrando SW', err));
  }
</script>
 <footer class="text-center mt-16 text-sm text-gray-500 dark:text-gray-400">
    <hr class="my-6 border-gray-300 dark:border-gray-700">
    <p>Esta app es gratuita, sin anuncios y hecha con amor para quien la necesite.</p>
    <p class="mt-1">— Aline RC ✨</p>
</footer>


</body></html>
<link rel="stylesheet" href="styles.css">
